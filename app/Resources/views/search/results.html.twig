{% extends 'base.html.twig' %}

{% block body %}
    <script type="text/javascript">

        if (localStorage.getItem('search')) {
            var searches = JSON.parse(localStorage.getItem('search'));

            if (searches.length > 4) {
                searches.pop()
            }
            searches.push("{{ searchTerm }}");
            localStorage.setItem('search', JSON.stringify(searches));
        } else {
            localStorage.setItem('search', JSON.stringify(["{{ searchTerm }}"]));
        }

        $(document).ready(function () {

            var lastSearches = JSON.parse(localStorage.getItem('search'));
            lastSearches.reverse();
            var lastSearchesInfo = '<ol>';

            $(lastSearches).each(function (id, text) {
                lastSearchesInfo += '<li><a href=" /search?q=' + text + '">' + text + '</a></li>';
            });

            $('.last-search').html(lastSearchesInfo);
        });
    </script>

    <div class="row">
        {{ form_start(searchForm, { 'attr': {'class': 'form-inline'} }) }}
        <div class="form-group row">
            <div class="col-lg-12">
                {{ form_widget(searchForm) }}
            </div>
        </div>
        {{ form_end(searchForm) }}
    </div>

    <div class="row">
        <p>{% trans with {'%search_term%': searchTerm, '%result_count%': results.getTotalItemCount} %}result info{% endtrans %}</p>
    </div>
    <div class="row result-list">
        <ol start="{{ offset + 1}}">
            {% for article in results %}
                <li>
                    <a href="{{ path('_lemma', {'id': article.internal_id}) }}">{{ article.lemma_normalized }}</a>
                    <br>
                    {{ attribute(highlightResults.results, article.id).fields.article_html.0 | striptags('<em>') | raw}}
                </li>
            {% endfor %}
        </ol>
    </div>

    <nav>
        {{ knp_pagination_render(results) }}
    </nav>

    <div class="row">{% trans %}your last searchterms{% endtrans %}:
        <div class="last-search"></div>
    </div>
{% endblock %}
